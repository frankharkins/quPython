# Logical qubit example

This page shows an example of programming in quPython by creating a
`LogicalQubit` class using the [five-qubit error correcting
code](https://en.wikipedia.org/wiki/Five-qubit_error_correcting_code). This
abstracts the bit-level operations away from the user so they can treat it like
a single qubit. This code also demonstrates a few other quPython features:

* The `measure` and `_measure_stabilizers` methods both allocate the extra
  qubits they need on the fly. The rest of the program can ignore them.
* The measurement methods return classical bit objects to be used in the
  program or returned to the user; no need to keep track of bit indices or
  registers.
* The `conditions` argument on a `Qubit` method accept both `Qubit` and
  `BitPromise` objects.

> [!NOTE]
> Beware that initializing `LogicalQubit` objects and calling `.correct()` are
> both expensive qubit-wise, so you can quickly create quantum programs that
> are too large to run on your computer.

```python
from math import pi
from qupython import Qubit, quantum
from qupython.typing import BitPromise

class LogicalQubit:
    """
    Simple logical qubit using the five-qubit code.
    See https://en.wikipedia.org/wiki/Five-qubit_error_correcting_code
    """
    def __init__(self):
        """
        Create new logical qubit and initialize to logical |0>.
        Uses initialization procedure from https://quantumcomputing.stackexchange.com/a/14449
        """
        self.qubits = [Qubit() for _ in range(5)]
        self.qubits[4].z()
        for q in self.qubits[:4]:
            q.h()
            with q.as_control():
                self.qubits[4].x()
        for a, b in [(0,4),(0,1),(2,3),(1,2),(3,4)]:
            with self.qubits[b].as_control():
                self.qubits[a].z()

    def x(self) -> None:
        """
        X-gate on logical qubit.
        Transforms logical |0> to logical |1> and vice versa.
        """
        for q in self.qubits:
            q.x()

    def z(self) -> None:
        """
        Z-gate on logical qubit.
        """
        for q in self.qubits:
            q.z()

    def measure(self) -> BitPromise:
        """
        Measure logical qubit to single classical bit
        """
        out = Qubit().h()
        for q in self.qubits:
            with out.as_control():
                q.z()
        return out.h().measure()

    def _measure_stabilizers(self) -> list[BitPromise]:
        """
        For use in `.correct()`; detects errors using syndrome measurements.
        """
        stabilizers = ["xzzxi", "ixzzx", "xixzz", "zxixz"]
        aux_qubits = [Qubit().h() for _ in range(4)]
        for control, string in zip(aux_qubits, stabilizers):
            for index, gate in enumerate(string):
                if gate == "i":
                    continue
                with control.as_control():
                    gate_method = getattr(self.qubits[index], gate)
                    gate_method()
        return [control.h().measure() for control in aux_qubits]

    def correct(self) -> None:
        """
        Detect and correct errors.
        """
        lookup_table = [
            # (syndrome measurement, gate, qubit index)
            ("0001", "x", 0), ("1010", "z", 0), ("1011", "y", 0),
            ("1000", "x", 1), ("0101", "z", 1), ("1101", "y", 1),
            ("1100", "x", 2), ("0010", "z", 2), ("1110", "y", 2),
            ("0110", "x", 3), ("1001", "z", 3), ("1111", "y", 3),
            ("0011", "x", 4), ("0100", "z", 4), ("0111", "y", 4)
        ]

        measurements = self._measure_stabilizers()
        for code, gate, index in lookup_table:
            conditions = [ bit if char=="1" else ~bit for bit, char in zip(measurements, code) ]
            qubit_method = getattr(self.qubits[index], gate)
            qubit_method(conditions=conditions)
```

Use the class in a function like so.

```python
@quantum
def test_logical_qubit() -> BitPromise:
    q = LogicalQubit()  # initialize qubit to |0>
    q.x()               # flip qubit to |1>
    q.qubits[2].x()     # simulate error
    q.correct()         # correct error
    return q.measure()
```

The function will always return `True`, since the logical qubit should be in
state $|1\rangle$ when we measure it.

```python
>>> test_logical_qubit()
True
```

This program is simple at the high-level of logical qubits, but very
complicated at the level of physical qubits. Check out the compiled Qiskit
circuit below.

```python
test_logical_qubit.compile()
test_logical_qubit.circuit.draw(fold=130)
```
<details><summary>Output (long; click to expand)</summary>

```
      ┌───┐                                                                                                                  »
 q_0: ┤ H ├───────────────────────────────────────────────────────■───────■──────────────────────────────────────■─────────■─»
      ├───┤                                        ┌───┐┌───┐     │       │          ┌───┐                       │         │ »
 q_1: ┤ H ├────────────■───────────■─────────────■─┤ X ├┤ X ├─────┼───■───┼───■──────┤ X ├───────────────────────┼─────────┼─»
      ├───┤            │           │             │ └───┘└───┘     │   │   │   │      └─┬─┘┌───┐┌─┐     ┌─┐       │     ┌─┐ │ »
 q_2: ┤ H ├────────────┼───────────┼─────────────┼───■────────■───┼───■───┼───┼───■────┼──┤ H ├┤M├─────┤M├───────┼─────┤M├─┼─»
      ├───┤┌───┐┌───┐┌─┴─┐┌───┐    │       ┌───┐ │   │        │   │       │   │   │    │  └───┘└╥┘┌───┐└╥┘       │     └╥┘ │ »
 q_3: ┤ Z ├┤ X ├┤ X ├┤ X ├┤ X ├─■──┼─────■─┤ X ├─┼───┼────────┼───┼───────┼───┼───┼────┼────────╫─┤ X ├─╫────────┼───■──╫──■─»
      ├───┤└─┬─┘└─┬─┘└───┘└─┬─┘ │  │     │ ├───┤ │ ┌─┴─┐┌───┐ │   │       │   │   │    │        ║ └─┬─┘ ║        │   │  ║    »
 q_4: ┤ H ├──■────┼─────────┼───■──┼──■──┼─┤ X ├─┼─┤ X ├┤ X ├─┼───■───────┼───┼───┼────┼────────╫───┼───╫────────┼───┼──╫────»
      ├───┤       │         │      │  │  │ └───┘ │ ├───┤└─┬─┘ │ ┌───┐   ┌─┴─┐ │   │    │        ║   │   ║        │   │  ║    »
 q_5: ┤ H ├───────■─────────┼──────┼──■──┼───────■─┤ X ├──┼───■─┤ X ├───┤ X ├─┼───┼────┼────────╫───┼───╫────────┼───┼──╫────»
      ├───┤                 │      │     │         └───┘  │     └─┬─┘   └───┘ │   │    │        ║   │   ║ ┌───┐  │   │  ║ ┌─┐»
 q_6: ┤ H ├─────────────────┼──────┼─────┼────────────────┼───────■───────────■───┼────┼────■───╫───■───╫─┤ H ├──┼───┼──╫─┤M├»
      ├───┤                 │      │     │                │                       │    │    │   ║       ║ └───┘  │   │  ║ └╥┘»
 q_7: ┤ H ├─────────────────┼──────┼─────┼────────────────┼───────────────────────┼────┼────┼───╫───────╫────────┼───┼──╫──╫─»
      ├───┤                 │      │     │ ┌───┐          │                     ┌─┴─┐  │    │   ║       ║      ┌─┴─┐ │  ║  ║ »
 q_8: ┤ H ├─────────────────■──────■─────■─┤ X ├──────────┼─────────────────────┤ X ├──┼────■───╫───■───╫──────┤ X ├─┼──╫──╫─»
      ├───┤                                └───┘          │                     └───┘  │        ║   │   ║      └───┘ │  ║  ║ »
 q_9: ┤ H ├───────────────────────────────────────────────■────────────────────────────■────────╫───■───╫────────────■──╫──╫─»
      └───┘                                                                                     ║       ║               ║  ║ »
c: 33/══════════════════════════════════════════════════════════════════════════════════════════╩═══════╩═══════════════╩══╩═»
                                                                                                21      12              9  4 »
«      ┌───┐                  ┌─┐         ┌─┐                                                                                  »
« q_0: ┤ H ├──────────────────┤M├─────────┤M├──────────────────────────────────────────────────────────────────────────────────»
«      └───┘                  └╥┘         └╥┘                                                                                  »
« q_1: ────────────────────────╫───────────╫───────────────────────────────────────────────────────────────────────────────────»
«           ┌─┐      ┌─┐       ║ ┌─┐       ║                                                                                   »
« q_2: ─────┤M├──────┤M├───────╫─┤M├───────╫───────────────────────────────────────────────────────────────────────────────────»
«           └╥┘      └╥┘       ║ └╥┘       ║                                                                                   »
« q_3: ──────╫────────╫────────╫──╫────────╫───────────────────────────────────────────────────────────────────────────────────»
«            ║        ║        ║  ║        ║   ┌──────     ┌──────    ┌──────     ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐ »
« q_4: ──────╫────────╫────────╫──╫────────╫───┤ If-0  ────┤ If-1  ───┤ If-2  ────┤ If-3  ──┤ X ├  End-3 ├─  End-2 ├─  End-1 ├─»
«            ║        ║        ║  ║        ║   └──╥───     └──╥───    └──╥───     └──╥───   └───┘ ───────┘  ───────┘  ───────┘ »
« q_5: ──────╫────────╫────────╫──╫────────╫──────╫───────────╫──────────╫───────────╫─────────────────────────────────────────»
«            ║ ┌─┐    ║ ┌─┐    ║  ║ ┌─┐    ║      ║           ║          ║           ║                                         »
« q_6: ──────╫─┤M├────╫─┤M├────╫──╫─┤M├────╫──────╫───────────╫──────────╫───────────╫─────────────────────────────────────────»
«            ║ └╥┘    ║ └╥┘    ║  ║ └╥┘    ║      ║           ║          ║           ║                                         »
« q_7: ──────╫──╫─────╫──╫─────╫──╫──╫─────╫──────╫───────────╫──────────╫───────────╫─────────────────────────────────────────»
«            ║  ║     ║  ║     ║  ║  ║     ║      ║           ║          ║           ║                                         »
« q_8: ──────╫──╫─────╫──╫─────╫──╫──╫─────╫──────╫───────────╫──────────╫───────────╫─────────────────────────────────────────»
«      ┌───┐ ║  ║ ┌─┐ ║  ║ ┌─┐ ║  ║  ║ ┌─┐ ║      ║           ║          ║           ║                                         »
« q_9: ┤ H ├─╫──╫─┤M├─╫──╫─┤M├─╫──╫──╫─┤M├─╫──────╫───────────╫──────────╫───────────╫─────────────────────────────────────────»
«      └───┘ ║  ║ └╥┘ ║  ║ └╥┘ ║  ║  ║ └╥┘ ║ ┌────╨─────┐┌────╨────┐┌────╨─────┐┌────╨─────┐                                   »
«c: 33/══════╩══╩══╩══╩══╩══╩══╩══╩══╩══╩══╩═╡ c_12=0x0 ╞╡ c_3=0x0 ╞╡ c_14=0x0 ╞╡ c_28=0x1 ╞═══════════════════════════════════»
«            30 3  7  23 8  14 28 24 22 0  15└──────────┘└─────────┘└──────────┘└──────────┘                                   »
«                         ┌─┐                                                                                                    »
« q_0: ───────────────────┤M├────────────────────────────────────────────────────────────────────────────────────────────────────»
«                         └╥┘                                                                                                    »
« q_1: ────────────────────╫─────────────────────────────────────────────────────────────────────────────────────────────────────»
«                ┌─┐       ║                                                                                            ┌─┐      »
« q_2: ──────────┤M├───────╫────────────────────────────────────────────────────────────────────────────────────────────┤M├──────»
«                └╥┘       ║                                                                                            └╥┘      »
« q_3: ───────────╫────────╫─────────────────────────────────────────────────────────────────────────────────────────────╫───────»
«       ───────┐  ║        ║   ┌──────     ┌──────    ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐  ║       »
« q_4:   End-0 ├──╫────────╫───┤ If-0  ────┤ If-1  ───┤ If-2  ───┤ If-3  ──┤ Z ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├──╫───────»
«       ───────┘  ║        ║   └──╥───     └──╥───    └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘  ║       »
« q_5: ───────────╫────────╫──────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────╫───────»
«                 ║ ┌─┐    ║      ║           ║          ║          ║                                                    ║ ┌─┐   »
« q_6: ───────────╫─┤M├────╫──────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────╫─┤M├───»
«                 ║ └╥┘    ║      ║           ║          ║          ║                                                    ║ └╥┘   »
« q_7: ───────────╫──╫─────╫──────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────╫──╫────»
«                 ║  ║     ║      ║           ║          ║          ║                                                    ║  ║    »
« q_8: ───────────╫──╫─────╫──────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────╫──╫────»
«                 ║  ║ ┌─┐ ║      ║           ║          ║          ║                                                    ║  ║ ┌─┐»
« q_9: ───────────╫──╫─┤M├─╫──────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────╫──╫─┤M├»
«                 ║  ║ └╥┘ ║ ┌────╨─────┐┌────╨────┐┌────╨────┐┌────╨─────┐                                              ║  ║ └╥┘»
«c: 33/═══════════╩══╩══╩══╩═╡ c_21=0x1 ╞╡ c_8=0x0 ╞╡ c_7=0x1 ╞╡ c_15=0x0 ╞══════════════════════════════════════════════╩══╩══╩═»
«                 11 29 17 16└──────────┘└─────────┘└─────────┘└──────────┘                                              26 32 27»
«      ┌─┐                                                                                                  ┌─┐            »
« q_0: ┤M├──────────────────────────────────────────────────────────────────────────────────────────────────┤M├────────────»
«      └╥┘                                                                                                  └╥┘            »
« q_1: ─╫────────────────────────────────────────────────────────────────────────────────────────────────────╫─────────────»
«       ║                                                                                                    ║             »
« q_2: ─╫────────────────────────────────────────────────────────────────────────────────────────────────────╫─────────────»
«       ║                                                                                                    ║             »
« q_3: ─╫────────────────────────────────────────────────────────────────────────────────────────────────────╫─────────────»
«       ║   ┌──────     ┌──────     ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐        ║             »
« q_4: ─╫───┤ If-0  ────┤ If-1  ────┤ If-2  ───┤ If-3  ──┤ Y ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├─────■──╫─────────────»
«       ║   └──╥───     └──╥───     └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘     │  ║   ┌──────   »
« q_5: ─╫──────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────────┼──╫───┤ If-0  ──»
«       ║      ║           ║           ║          ║                                                   ┌─┐ │  ║   └──╥───   »
« q_6: ─╫──────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────┤M├─┼──╫──────╫──────»
«       ║      ║           ║           ║          ║                                                   └╥┘ │  ║      ║      »
« q_7: ─╫──────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────╫──■──╫──────╫──────»
«       ║      ║           ║           ║          ║                                                    ║     ║      ║      »
« q_8: ─╫──────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────╫─────╫──────╫──────»
«       ║      ║           ║           ║          ║                                                    ║ ┌─┐ ║      ║      »
« q_9: ─╫──────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────╫─┤M├─╫──────╫──────»
«       ║ ┌────╨─────┐┌────╨─────┐┌────╨────┐┌────╨─────┐                                              ║ └╥┘ ║ ┌────╨─────┐»
«c: 33/═╩═╡ c_21=0x1 ╞╡ c_22=0x0 ╞╡ c_7=0x1 ╞╡ c_28=0x1 ╞══════════════════════════════════════════════╩══╩══╩═╡ c_21=0x1 ╞»
«       18└──────────┘└──────────┘└─────────┘└──────────┘                                              6  10 31└──────────┘»
«                                                                                            ┌─┐                      »
« q_0: ──────────────────────────────────────────────────────────────────────────────────────┤M├──────────────────────»
«                                                                                            └╥┘                      »
« q_1: ───────────────────────────────────────────────────────────────────────────────────────╫───────────────────────»
«                                                                                             ║                       »
« q_2: ───────────────────────────────────────────────────────────────────────────────────────╫───────────────────────»
«                                                                                             ║                       »
« q_3: ───────────────────────────────────────────────────────────────────────────────────────╫───────────────────────»
«                                                                                             ║                       »
« q_4: ───────────────────────────────────────────────────────────────────────────────────────╫───────────────────────»
«        ┌──────     ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐        ║   ┌──────    ┌──────  »
« q_5: ──┤ If-1  ────┤ If-2  ───┤ If-3  ──┤ X ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├────────╫───┤ If-0  ───┤ If-1  ─»
«        └──╥───     └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘ ┌─┐    ║   └──╥───    └──╥───  »
« q_6: ─────╫───────────╫──────────╫───────────────────────────────────────────────────┤M├────╫──────╫──────────╫─────»
«           ║           ║          ║                                                   └╥┘    ║      ║          ║     »
« q_7: ─────╫───────────╫──────────╫────────────────────────────────────────────────────╫─────╫──────╫──────────╫─────»
«           ║           ║          ║                                                    ║     ║      ║          ║     »
« q_8: ─────╫───────────╫──────────╫────────────────────────────────────────────────────╫─────╫──────╫──────────╫─────»
«           ║           ║          ║                                                    ║ ┌─┐ ║      ║          ║     »
« q_9: ─────╫───────────╫──────────╫────────────────────────────────────────────────────╫─┤M├─╫──────╫──────────╫─────»
«      ┌────╨─────┐┌────╨────┐┌────╨─────┐                                              ║ └╥┘ ║ ┌────╨────┐┌────╨────┐»
«c: 33/╡ c_29=0x0 ╞╡ c_0=0x0 ╞╡ c_16=0x0 ╞══════════════════════════════════════════════╩══╩══╩═╡ c_9=0x0 ╞╡ c_4=0x1 ╞»
«      └──────────┘└─────────┘└──────────┘                                              25 1  19└─────────┘└─────────┘»
«                                                                              ┌─┐                                               »
« q_0: ────────────────────────────────────────────────────────────────────────┤M├───────────────────────────────────────────────»
«                                                                              └╥┘                                               »
« q_1: ─────────────────────────────────────────────────────────────────────────╫────────────────────────────────────────────────»
«                                                                               ║                                                »
« q_2: ─────────────────────────────────────────────────────────────────────────╫────────────────────────────────────────────────»
«                                                                               ║                                                »
« q_3: ─────────────────────────────────────────────────────────────────────────╫────────────────────────────────────────────────»
«                                                                               ║                                                »
« q_4: ─────────────────────────────────────────────────────────────────────────╫────────────────────────────────────────────────»
«        ┌──────     ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐     ║   ┌──────     ┌──────    ┌──────     ┌──────   »
« q_5: ──┤ If-2  ────┤ If-3  ──┤ Z ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├─────╫───┤ If-0  ────┤ If-1  ───┤ If-2  ────┤ If-3  ──»
«        └──╥───     └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘     ║   └──╥───     └──╥───    └──╥───     └──╥───   »
« q_6: ─────╫───────────╫───────────────────────────────────────────────────────╫──────╫───────────╫──────────╫───────────╫──────»
«           ║           ║                                                       ║      ║           ║          ║           ║      »
« q_7: ─────╫───────────╫───────────────────────────────────────────────────────╫──────╫───────────╫──────────╫───────────╫──────»
«           ║           ║                                                       ║      ║           ║          ║           ║      »
« q_8: ─────╫───────────╫───────────────────────────────────────────────────────╫──────╫───────────╫──────────╫───────────╫──────»
«           ║           ║                                                   ┌─┐ ║      ║           ║          ║           ║      »
« q_9: ─────╫───────────╫───────────────────────────────────────────────────┤M├─╫──────╫───────────╫──────────╫───────────╫──────»
«      ┌────╨─────┐┌────╨─────┐                                             └╥┘ ║ ┌────╨─────┐┌────╨────┐┌────╨─────┐┌────╨─────┐»
«c: 33/╡ c_17=0x0 ╞╡ c_28=0x1 ╞══════════════════════════════════════════════╩══╩═╡ c_21=0x1 ╞╡ c_4=0x1 ╞╡ c_27=0x0 ╞╡ c_28=0x1 ╞»
«      └──────────┘└──────────┘                                              13 5 └──────────┘└─────────┘└──────────┘└──────────┘»
«                                                   ┌─┐                                                                          »
« q_0: ─────────────────────────────────────────────┤M├──────────────────────────────────────────────────────────────────────────»
«                                                   └╥┘     ┌──────     ┌──────    ┌──────     ┌──────   ┌───┐ ───────┐  ───────┐»
« q_1: ──────────────────────────────────────────────╫──────┤ If-0  ────┤ If-1  ───┤ If-2  ────┤ If-3  ──┤ X ├  End-3 ├─  End-2 ├»
«                                                    ║      └──╥───     └──╥───    └──╥───     └──╥───   └───┘ ───────┘  ───────┘»
« q_2: ──────────────────────────────────────────────╫─────────╫───────────╫──────────╫───────────╫──────────────────────────────»
«                                                    ║         ║           ║          ║           ║                              »
« q_3: ──────────────────────────────────────────────╫─────────╫───────────╫──────────╫───────────╫──────────────────────────────»
«                                                    ║         ║           ║          ║           ║                              »
« q_4: ──────────────────────────────────────────────╫─────────╫───────────╫──────────╫───────────╫──────────────────────────────»
«      ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐  ║         ║           ║          ║           ║                              »
« q_5: ┤ Y ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├──╫──■──────╫───────────╫──────────╫───────────╫──────────────────────────────»
«      └───┘ ───────┘  ───────┘  ───────┘  ───────┘  ║  │      ║           ║          ║           ║                              »
« q_6: ──────────────────────────────────────────────╫──┼──────╫───────────╫──────────╫───────────╫──────────────────────────────»
«                                                    ║  │      ║           ║          ║           ║                              »
« q_7: ──────────────────────────────────────────────╫──■──────╫───────────╫──────────╫───────────╫──────────────────────────────»
«                                                    ║         ║           ║          ║           ║                              »
« q_8: ──────────────────────────────────────────────╫─────────╫───────────╫──────────╫───────────╫──────────────────────────────»
«                                                    ║         ║           ║          ║           ║                              »
« q_9: ──────────────────────────────────────────────╫─────────╫───────────╫──────────╫───────────╫──────────────────────────────»
«                                                    ║    ┌────╨─────┐┌────╨────┐┌────╨─────┐┌────╨─────┐                        »
«c: 33/══════════════════════════════════════════════╩════╡ c_21=0x1 ╞╡ c_4=0x1 ╞╡ c_10=0x0 ╞╡ c_18=0x0 ╞════════════════════════»
«                                                    20   └──────────┘└─────────┘└──────────┘└──────────┘                        »
«                                                                                                                       »
« q_0: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«        ───────┐  ───────┐   ┌──────     ┌──────     ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐ »
« q_1: ─  End-1 ├─  End-0 ├───┤ If-0  ────┤ If-1  ────┤ If-2  ───┤ If-3  ──┤ Z ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├─»
«        ───────┘  ───────┘   └──╥───     └──╥───     └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘ »
« q_2: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_3: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_4: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_5: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_6: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_7: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_8: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                                ║           ║           ║          ║                                                   »
« q_9: ──────────────────────────╫───────────╫───────────╫──────────╫───────────────────────────────────────────────────»
«                           ┌────╨─────┐┌────╨─────┐┌────╨────┐┌────╨─────┐                                             »
«c: 33/═════════════════════╡ c_30=0x0 ╞╡ c_32=0x0 ╞╡ c_7=0x1 ╞╡ c_31=0x0 ╞═════════════════════════════════════════════»
«                           └──────────┘└──────────┘└─────────┘└──────────┘                                             »
«                                                                                                                           »
« q_0: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«        ┌──────     ┌──────    ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐                           »
« q_1: ──┤ If-0  ────┤ If-1  ───┤ If-2  ───┤ If-3  ──┤ Y ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├──■────────────────────────»
«        └──╥───     └──╥───    └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘  │                        »
« q_2: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────┼────────────────────────»
«           ║           ║          ║          ║                                                    │                        »
« q_3: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────┼────────────────────────»
«           ║           ║          ║          ║                                                    │                        »
« q_4: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────┼────────────────────────»
«           ║           ║          ║          ║                                                    │                        »
« q_5: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────┼────────────────────────»
«           ║           ║          ║          ║                                                    │                        »
« q_6: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────┼────────────────────────»
«           ║           ║          ║          ║                                                    │                        »
« q_7: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────■────────────────────────»
«           ║           ║          ║          ║                                                        ┌──────     ┌──────  »
« q_8: ─────╫───────────╫──────────╫──────────╫────────────────────────────────────────────────────────┤ If-0  ────┤ If-1  ─»
«           ║           ║          ║          ║                                                        └──╥───     └──╥───  »
« q_9: ─────╫───────────╫──────────╫──────────╫───────────────────────────────────────────────────────────╫───────────╫─────»
«      ┌────╨─────┐┌────╨────┐┌────╨────┐┌────╨─────┐                                                ┌────╨─────┐┌────╨────┐»
«c: 33/╡ c_21=0x1 ╞╡ c_4=0x1 ╞╡ c_7=0x1 ╞╡ c_19=0x0 ╞════════════════════════════════════════════════╡ c_23=0x0 ╞╡ c_4=0x1 ╞»
«      └──────────┘└─────────┘└─────────┘└──────────┘                                                └──────────┘└─────────┘»
«                                                                                                                            »
« q_0: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_1: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_2: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_3: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_4: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_5: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_6: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                            »
« q_7: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«        ┌──────    ┌──────  ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐   ┌──────     ┌──────    ┌──────    ┌──────   ┌───┐»
« q_8: ──┤ If-2  ───┤ If-3  ─┤ X ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├───┤ If-0  ────┤ If-1  ───┤ If-2  ───┤ If-3  ──┤ Z ├»
«        └──╥───    └──╥───  └───┘ ───────┘  ───────┘  ───────┘  ───────┘   └──╥───     └──╥───    └──╥───    └──╥───   └───┘»
« q_9: ─────╫──────────╫───────────────────────────────────────────────────────╫───────────╫──────────╫──────────╫───────────»
«      ┌────╨────┐┌────╨────┐                                             ┌────╨─────┐┌────╨────┐┌────╨────┐┌────╨─────┐     »
«c: 33/╡ c_7=0x1 ╞╡ c_5=0x0 ╞═════════════════════════════════════════════╡ c_21=0x1 ╞╡ c_6=0x0 ╞╡ c_1=0x0 ╞╡ c_28=0x1 ╞═════»
«      └─────────┘└─────────┘                                             └──────────┘└─────────┘└─────────┘└──────────┘     »
«                                                                                                                               »
« q_0: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_1: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_2: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_3: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_4: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_5: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_6: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                               »
« q_7: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«       ───────┐  ───────┐  ───────┐  ───────┐   ┌──────     ┌──────    ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐ »
« q_8:   End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├───┤ If-0  ────┤ If-1  ───┤ If-2  ───┤ If-3  ──┤ Y ├  End-3 ├─  End-2 ├─  End-1 ├─»
«       ───────┘  ───────┘  ───────┘  ───────┘   └──╥───     └──╥───    └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘ »
« q_9: ─────────────────────────────────────────────╫───────────╫──────────╫──────────╫─────────────────────────────────────────»
«                                              ┌────╨─────┐┌────╨────┐┌────╨────┐┌────╨─────┐                                   »
«c: 33/════════════════════════════════════════╡ c_21=0x1 ╞╡ c_4=0x1 ╞╡ c_7=0x1 ╞╡ c_28=0x1 ╞═══════════════════════════════════»
«                                              └──────────┘└─────────┘└─────────┘└──────────┘                                   »
«                                                                                                                           »
« q_0: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                           »
« q_1: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                           »
« q_2: ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                     ┌──────     ┌──────     ┌──────    ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐   ┌──────   »
« q_3: ───────────────┤ If-0  ────┤ If-1  ────┤ If-2  ───┤ If-3  ──┤ X ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├───┤ If-0  ──»
«                     └──╥───     └──╥───     └──╥───    └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘   └──╥───   »
« q_4: ──────────────────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────────╫──────»
«                        ║           ║           ║          ║                                                        ║      »
« q_5: ──────────────────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────────╫──────»
«                        ║           ║           ║          ║                                                        ║      »
« q_6: ──────────────────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────────╫──────»
«                        ║           ║           ║          ║                                                        ║      »
« q_7: ───────────■──────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────────╫──────»
«       ───────┐  │      ║           ║           ║          ║                                                        ║      »
« q_8:   End-0 ├──■──────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────────╫──────»
«       ───────┘         ║           ║           ║          ║                                                        ║      »
« q_9: ──────────────────╫───────────╫───────────╫──────────╫────────────────────────────────────────────────────────╫──────»
«                   ┌────╨─────┐┌────╨─────┐┌────╨────┐┌────╨─────┐                                             ┌────╨─────┐»
«c: 33/═════════════╡ c_24=0x0 ╞╡ c_25=0x0 ╞╡ c_7=0x1 ╞╡ c_28=0x1 ╞═════════════════════════════════════════════╡ c_11=0x0 ╞»
«                   └──────────┘└──────────┘└─────────┘└──────────┘                                             └──────────┘»
«                                                                                                                        »
« q_0: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                        »
« q_1: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«                                                                                                                        »
« q_2: ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────»
«        ┌──────    ┌──────     ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐   ┌──────     ┌──────    ┌──────  »
« q_3: ──┤ If-1  ───┤ If-2  ────┤ If-3  ──┤ Z ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├───┤ If-0  ────┤ If-1  ───┤ If-2  ─»
«        └──╥───    └──╥───     └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘   └──╥───     └──╥───    └──╥───  »
« q_4: ─────╫──────────╫───────────╫────────────────────────────────────────────────────────╫───────────╫──────────╫─────»
«           ║          ║           ║                                                        ║           ║          ║     »
« q_5: ─────╫──────────╫───────────╫────────────────────────────────────────────────────────╫───────────╫──────────╫─────»
«           ║          ║           ║                                                        ║           ║          ║     »
« q_6: ─────╫──────────╫───────────╫────────────────────────────────────────────────────────╫───────────╫──────────╫─────»
«           ║          ║           ║                                                        ║           ║          ║     »
« q_7: ─────╫──────────╫───────────╫────────────────────────────────────────────────────────╫───────────╫──────────╫─────»
«           ║          ║           ║                                                        ║           ║          ║     »
« q_8: ─────╫──────────╫───────────╫────────────────────────────────────────────────────────╫───────────╫──────────╫─────»
«           ║          ║           ║                                                        ║           ║          ║     »
« q_9: ─────╫──────────╫───────────╫────────────────────────────────────────────────────────╫───────────╫──────────╫─────»
«      ┌────╨────┐┌────╨─────┐┌────╨─────┐                                             ┌────╨─────┐┌────╨────┐┌────╨────┐»
«c: 33/╡ c_4=0x1 ╞╡ c_13=0x0 ╞╡ c_20=0x0 ╞═════════════════════════════════════════════╡ c_26=0x0 ╞╡ c_4=0x1 ╞╡ c_7=0x1 ╞»
«      └─────────┘└──────────┘└──────────┘                                             └──────────┘└─────────┘└─────────┘»
«                                                                          
« q_0: ────────────────────────────────────────────────────────────────────
«                                                                          
« q_1: ────────────────────────────────────────────────────────────────────
«                                                                          
« q_2: ────────────────────────────────────────────────────────────────────
«        ┌──────   ┌───┐ ───────┐  ───────┐  ───────┐  ───────┐            
« q_3: ──┤ If-3  ──┤ Y ├  End-3 ├─  End-2 ├─  End-1 ├─  End-0 ├──■─────────
«        └──╥───   └───┘ ───────┘  ───────┘  ───────┘  ───────┘  │         
« q_4: ─────╫────────────────────────────────────────────────────┼─────────
«           ║                                                    │         
« q_5: ─────╫────────────────────────────────────────────────────┼─────────
«           ║                                                    │         
« q_6: ─────╫────────────────────────────────────────────────────┼─────────
«           ║                                                    │ ┌───┐┌─┐
« q_7: ─────╫────────────────────────────────────────────────────■─┤ H ├┤M├
«           ║                                                      └───┘└╥┘
« q_8: ─────╫────────────────────────────────────────────────────────────╫─
«           ║                                                            ║ 
« q_9: ─────╫────────────────────────────────────────────────────────────╫─
«      ┌────╨─────┐                                                      ║ 
«c: 33/╡ c_28=0x1 ╞══════════════════════════════════════════════════════╩═
«      └──────────┘                                                      2 
```
</details>
